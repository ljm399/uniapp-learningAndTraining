# 09-compiler-uni é¡¹ç›®æ£€æŸ¥æŠ¥å‘Š

> æ£€æŸ¥æ—¶é—´: 2024 å¹´ 12 æœˆ 4 æ—¥  
> åŸé¡¹ç›®æ—¶é—´: 2022 å¹´  
> é¡¹ç›®ç±»å‹: uni-app ç¼–è¯‘å™¨å­¦ä¹ é¡¹ç›®

---

## ğŸ“‹ æ£€æŸ¥æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå­¦ä¹  uni-app ç¼–è¯‘ç›¸å…³é…ç½®çš„é¡¹ç›®ã€‚

---

## âŒ ä¸¥é‡è¿‡æœŸå†…å®¹

### 1. ç¼–è¯‘å™¨é…ç½®å·²åºŸå¼ƒ

**æ–‡ä»¶**: `manifest.json` (ç¬¬ 11-12 è¡Œ)

**é—®é¢˜ä»£ç **:

```json
"app-plus": {
    "nvueStyleCompiler": "uni-app",
    "compilerVersion": 3
}
```

**é—®é¢˜è¯´æ˜**:

1. **nvueStyleCompiler**: å·²ç»Ÿä¸€ä¸º "uni-app" æ¨¡å¼ï¼Œæ— éœ€é…ç½®
2. **compilerVersion**: é…ç½®é¡¹å·²åºŸå¼ƒï¼ŒVue 3 é¡¹ç›®è‡ªåŠ¨ä½¿ç”¨æ–°ç¼–è¯‘å™¨

**å®˜æ–¹æ¨è**: ç›´æ¥ç§»é™¤è¿™ä¸¤ä¸ªé…ç½®é¡¹

**ä¿®æ”¹å»ºè®®**:

```json
"app-plus": {
    "usingComponents": true,
    "splashscreen": {
        "alwaysShowBeforeRender": true,
        "waiting": true,
        "autoclose": true,
        "delay": 0
    }
}
```

**å‚è€ƒæ–‡æ¡£**: https://uniapp.dcloud.net.cn/tutorial/compiler.html

---

## ğŸ“š ç¼–è¯‘å™¨çŸ¥è¯†æ›´æ–°

### 1. Vue 3 ç¼–è¯‘å™¨

**å½“å‰çŠ¶æ€**:

- uni-app å·²å…¨é¢æ”¯æŒ Vue 3
- ç¼–è¯‘å™¨è‡ªåŠ¨è¯†åˆ« Vue ç‰ˆæœ¬
- æ— éœ€æ‰‹åŠ¨é…ç½®ç¼–è¯‘å™¨ç‰ˆæœ¬

**é…ç½®æ–¹å¼**:

```json
{
  "vueVersion": "3"
}
```

åªéœ€é…ç½® `vueVersion` å³å¯ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¤„ç†ã€‚

---

### 2. ç¼–è¯‘æ¨¡å¼

**å¼€å‘æ¨¡å¼**:

```bash
# å¼€å‘æ¨¡å¼ç¼–è¯‘
npm run dev:mp-weixin
npm run dev:h5
npm run dev:app
```

**ç”Ÿäº§æ¨¡å¼**:

```bash
# ç”Ÿäº§æ¨¡å¼ç¼–è¯‘ï¼ˆä¼šè¿›è¡Œä»£ç å‹ç¼©å’Œä¼˜åŒ–ï¼‰
npm run build:mp-weixin
npm run build:h5
npm run build:app
```

---

### 3. æ¡ä»¶ç¼–è¯‘

æ¡ä»¶ç¼–è¯‘ä»ç„¶æ˜¯é‡è¦åŠŸèƒ½ï¼š

```vue
<!-- #ifdef H5 -->
<view>è¿™æ®µä»£ç åªåœ¨ H5 å¹³å°ç¼–è¯‘</view>
<!-- #endif -->

<!-- #ifdef MP-WEIXIN -->
<view>è¿™æ®µä»£ç åªåœ¨å¾®ä¿¡å°ç¨‹åºç¼–è¯‘</view>
<!-- #endif -->

<!-- #ifdef APP-PLUS -->
<view>è¿™æ®µä»£ç åªåœ¨ App å¹³å°ç¼–è¯‘</view>
<!-- #endif -->
```

âœ… æ¡ä»¶ç¼–è¯‘è¯­æ³•ä»ç„¶æœ‰æ•ˆ

---

## âœ… ä»ç„¶æœ‰æ•ˆçš„å†…å®¹

### 1. vueVersion é…ç½®

```json
{
  "vueVersion": "3"
}
```

âœ… Vue 3 é…ç½®æ­£ç¡®

---

### 2. ç¼–è¯‘è¾“å‡ºç›®å½•

```
é¡¹ç›®æ ¹ç›®å½•/
  â””â”€â”€ unpackage/
      â””â”€â”€ dist/
          â”œâ”€â”€ dev/          # å¼€å‘æ¨¡å¼è¾“å‡º
          â”‚   â”œâ”€â”€ mp-weixin/
          â”‚   â”œâ”€â”€ h5/
          â”‚   â””â”€â”€ app-plus/
          â””â”€â”€ build/        # ç”Ÿäº§æ¨¡å¼è¾“å‡º
              â”œâ”€â”€ mp-weixin/
              â”œâ”€â”€ h5/
              â””â”€â”€ app-plus/
```

âœ… è¾“å‡ºç›®å½•ç»“æ„ä»ç„¶æœ‰æ•ˆ

---

## ğŸ’¡ ç¼–è¯‘ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨ esbuild åŠ é€Ÿç¼–è¯‘

åœ¨ `vite.config.js` ä¸­é…ç½®ï¼š

```javascript
import { defineConfig } from "vite";
import uni from "@dcloudio/vite-plugin-uni";

export default defineConfig({
  plugins: [uni()],
  build: {
    minify: "esbuild", // ä½¿ç”¨ esbuild å‹ç¼©
    target: "es2015",
  },
});
```

---

### 2. é…ç½®ç¼–è¯‘ç¼“å­˜

```javascript
export default defineConfig({
  plugins: [uni()],
  cacheDir: "node_modules/.vite", // é…ç½®ç¼“å­˜ç›®å½•
});
```

---

### 3. ä¼˜åŒ–ç¼–è¯‘é€Ÿåº¦

```javascript
export default defineConfig({
  plugins: [uni()],
  server: {
    hmr: true, // å¯ç”¨çƒ­æ›´æ–°
  },
  build: {
    sourcemap: false, // ç”Ÿäº§ç¯å¢ƒå…³é—­ sourcemap
    rollupOptions: {
      output: {
        manualChunks: {
          vue: ["vue", "pinia"],
        },
      },
    },
  },
});
```

---

## ğŸ”§ éœ€è¦æ‰§è¡Œçš„æ“ä½œ

### ç«‹å³ä¿®æ”¹ (é«˜ä¼˜å…ˆçº§ âŒ)

1. âŒ ç§»é™¤ `manifest.json` ä¸­çš„ `compilerVersion` é…ç½®
2. âŒ ç§»é™¤ `manifest.json` ä¸­çš„ `nvueStyleCompiler` é…ç½®

### å»ºè®®ä¼˜åŒ– (ä¸­ä¼˜å…ˆçº§ âš ï¸)

1. âš ï¸ æ·»åŠ  `vite.config.js` é…ç½®æ–‡ä»¶
2. âš ï¸ é…ç½®ç¼–è¯‘ä¼˜åŒ–é€‰é¡¹
3. âš ï¸ å¯ç”¨ç¼–è¯‘ç¼“å­˜

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [uni-app ç¼–è¯‘å™¨](https://uniapp.dcloud.net.cn/tutorial/compiler.html)
- [æ¡ä»¶ç¼–è¯‘](https://uniapp.dcloud.net.cn/tutorial/platform.html)
- [Vite é…ç½®](https://uniapp.dcloud.net.cn/collocation/vite-config.html)
- [Vue 3 è¿ç§»æŒ‡å—](https://uniapp.dcloud.net.cn/tutorial/migration-to-vue3.html)

---

## ğŸ“ æ¨èé…ç½®

### manifest.json æ¨èé…ç½®

```json
{
  "name": "é¡¹ç›®åç§°",
  "appid": "__UNI__XXXXXX",
  "versionName": "1.0.0",
  "versionCode": "100",
  "vueVersion": "3",
  "app-plus": {
    "usingComponents": true,
    "compatible": {
      "ignoreVersion": true
    }
  },
  "mp-weixin": {
    "appid": "",
    "setting": {
      "urlCheck": false
    },
    "usingComponents": true,
    "lazyCodeLoading": "requiredComponents"
  },
  "h5": {
    "devServer": {
      "https": false
    }
  }
}
```

### vite.config.js æ¨èé…ç½®

```javascript
import { defineConfig } from "vite";
import uni from "@dcloudio/vite-plugin-uni";

export default defineConfig({
  plugins: [uni()],
  server: {
    port: 3000,
    hmr: true,
  },
  build: {
    minify: "esbuild",
    target: "es2015",
    sourcemap: false,
  },
});
```

---

**æ£€æŸ¥å®Œæˆ** âœ“

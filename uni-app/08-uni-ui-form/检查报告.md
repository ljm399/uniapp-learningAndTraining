# 08-uni-ui-form é¡¹ç›®æ£€æŸ¥æŠ¥å‘Š

> æ£€æŸ¥æ—¶é—´: 2024 å¹´ 12 æœˆ 4 æ—¥  
> åŸé¡¹ç›®æ—¶é—´: 2022 å¹´  
> é¡¹ç›®ç±»å‹: uni-ui è¡¨å•ç»„ä»¶å­¦ä¹ é¡¹ç›®

---

## ğŸ“‹ æ£€æŸ¥æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå­¦ä¹  uni-forms è¡¨å•ç»„ä»¶çš„é¡¹ç›®ï¼ŒåŒ…å«è¡¨å•éªŒè¯ã€è¾“å…¥æ¡†ç­‰åŠŸèƒ½ã€‚

---

## âš ï¸ API å˜æ›´

### 1. modelValue å±æ€§åç§°å˜æ›´

**æ–‡ä»¶**: `pages/login/login.vue` (ç¬¬ 3 è¡Œ)

**å½“å‰ä»£ç **:

```vue
<uni-forms ref="form" :modelValue="formData" :rules="rules">
```

**é—®é¢˜è¯´æ˜**:

- `:modelValue` æ˜¯æ—§ç‰ˆæœ¬çš„å±æ€§å
- æ–°ç‰ˆæœ¬æ¨èä½¿ç”¨ `:model` æˆ– `v-model`
- å¯èƒ½å¯¼è‡´æ•°æ®ç»‘å®šé—®é¢˜

**å®˜æ–¹æ¨è**: ä½¿ç”¨ `:model` æˆ– `v-model`

**ä¿®æ”¹å»ºè®®**:

**æ–¹æ¡ˆ 1: ä½¿ç”¨ :model**

```vue
<uni-forms ref="form" :model="formData" :rules="rules">
```

**æ–¹æ¡ˆ 2: ä½¿ç”¨ v-model**

```vue
<uni-forms ref="form" v-model="formData" :rules="rules">
```

**å‚è€ƒæ–‡æ¡£**: https://uniapp.dcloud.net.cn/component/uniui/uni-forms.html

---

### 2. è¡¨å•éªŒè¯æ–¹æ³•ä¼˜åŒ–

**æ–‡ä»¶**: `pages/login/login.vue` (ç¬¬ 59-65 è¡Œ)

**å½“å‰ä»£ç **:

```javascript
this.$refs.form
  .validate()
  .then((value) => {
    console.log(value);
  })
  .catch((err) => {
    console.error(err);
  });
```

**é—®é¢˜è¯´æ˜**:

- Promise é“¾å¼è°ƒç”¨ä»£ç è¾ƒå†—é•¿
- é”™è¯¯å¤„ç†ä¸å¤Ÿæ¸…æ™°

**å»ºè®®**: ä½¿ç”¨ async/await è¯­æ³•

**ä¿®æ”¹å»ºè®®**:

```javascript
async submit() {
    try {
        const value = await this.$refs.form.validate()
        console.log('éªŒè¯é€šè¿‡', value)
        // æäº¤è¡¨å•æ•°æ®
        await this.submitForm(value)
    } catch (err) {
        console.error('éªŒè¯å¤±è´¥', err)
    }
}
```

**ä¼˜åŠ¿**:

- âœ… ä»£ç æ›´ç®€æ´æ˜“è¯»
- âœ… é”™è¯¯å¤„ç†æ›´æ¸…æ™°
- âœ… ä¾¿äºæ·»åŠ åç»­é€»è¾‘

---

## âœ… ä»ç„¶æœ‰æ•ˆçš„å†…å®¹

### 1. è¡¨å•åŸºæœ¬ç»“æ„

```vue
<uni-forms ref="form" :model="formData" :rules="rules">
    <uni-forms-item label="è´¦å·" name="username" required>
        <uni-easyinput 
            type="text" 
            v-model="formData.username" 
            placeholder="è¯·è¾“å…¥è´¦å·">
        </uni-easyinput>
    </uni-forms-item>
    
    <uni-forms-item label="å¯†ç " name="password" required>
        <uni-easyinput 
            type="password" 
            v-model="formData.password" 
            placeholder="è¯·è¾“å…¥å¯†ç ">
        </uni-easyinput>
    </uni-forms-item>
</uni-forms>
```

âœ… åŸºæœ¬ç»“æ„æ­£ç¡®

---

### 2. è¡¨å•éªŒè¯è§„åˆ™

```javascript
rules: {
    username: {
        rules: [
            {
                required: true,
                errorMessage: 'è¯·è¾“å…¥è´¦å·'
            }
        ]
    },
    password: {
        rules: [
            {
                required: true,
                errorMessage: 'è¯·è¾“å…¥å¯†ç '
            },
            {
                minLength: 6,
                maxLength: 8,
                errorMessage: 'è¯·è¾“å…¥6-8ä½çš„å¯†ç '
            }
        ]
    }
}
```

âœ… éªŒè¯è§„åˆ™é…ç½®æ­£ç¡®

---

### 3. è¡¨å•é‡ç½®æ–¹æ³•

```javascript
reset() {
    // æ¸…é™¤è¡¨å•éªŒè¯çš„ç»“æœ
    this.$refs.form.clearValidate()
    // é‡ç½®è¡¨å•çš„å€¼
    Object.keys(this.formData).forEach((key) => {
        this.formData[key] = null
    })
}
```

âœ… é‡ç½®æ–¹æ³•æ­£ç¡®

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨ Composition API

**å½“å‰å†™æ³•**:

```vue
<script>
export default {
  data() {
    return {
      formData: {},
      rules: {},
    };
  },
  methods: {
    submit() {},
  },
};
</script>
```

**æ¨èå†™æ³•**:

```vue
<script setup>
import { ref, reactive } from "vue";

const formRef = ref();
const formData = reactive({
  username: null,
  password: null,
});

const rules = {
  username: {
    rules: [{ required: true, errorMessage: "è¯·è¾“å…¥è´¦å·" }],
  },
  password: {
    rules: [
      { required: true, errorMessage: "è¯·è¾“å…¥å¯†ç " },
      { minLength: 6, maxLength: 8, errorMessage: "è¯·è¾“å…¥6-8ä½çš„å¯†ç " },
    ],
  },
};

const submit = async () => {
  try {
    const value = await formRef.value.validate();
    console.log("éªŒè¯é€šè¿‡", value);
  } catch (err) {
    console.error("éªŒè¯å¤±è´¥", err);
  }
};

const reset = () => {
  formRef.value.clearValidate();
  Object.keys(formData).forEach((key) => {
    formData[key] = null;
  });
};
</script>
```

---

### 2. æ·»åŠ æ›´å¤šéªŒè¯è§„åˆ™

```javascript
rules: {
    email: {
        rules: [
            { required: true, errorMessage: 'è¯·è¾“å…¥é‚®ç®±' },
            {
                format: 'email',
                errorMessage: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'
            }
        ]
    },
    phone: {
        rules: [
            { required: true, errorMessage: 'è¯·è¾“å…¥æ‰‹æœºå·' },
            {
                pattern: /^1[3-9]\d{9}$/,
                errorMessage: 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®'
            }
        ]
    },
    age: {
        rules: [
            {
                validateFunction: (rule, value, data, callback) => {
                    if (value < 18) {
                        callback('å¹´é¾„å¿…é¡»å¤§äº18å²')
                    }
                    return true
                }
            }
        ]
    }
}
```

---

### 3. æ·»åŠ è¡¨å•æäº¤åŠ è½½çŠ¶æ€

```vue
<script setup>
import { ref } from "vue";

const loading = ref(false);

const submit = async () => {
  try {
    loading.value = true;
    const value = await formRef.value.validate();

    // æäº¤åˆ°æœåŠ¡å™¨
    await api.login(value);

    uni.showToast({
      title: "ç™»å½•æˆåŠŸ",
      icon: "success",
    });
  } catch (err) {
    console.error(err);
  } finally {
    loading.value = false;
  }
};
</script>

<template>
  <button type="default" @click="submit" :loading="loading" :disabled="loading">
    {{ loading ? "æäº¤ä¸­..." : "æäº¤è¡¨å•" }}
  </button>
</template>
```

---

## ğŸ”§ éœ€è¦æ‰§è¡Œçš„æ“ä½œ

### ç«‹å³ä¿®æ”¹ (é«˜ä¼˜å…ˆçº§ âŒ)

1. âŒ å°† `:modelValue` æ”¹ä¸º `:model`
2. âŒ æ›´æ–° uni-forms ç»„ä»¶åˆ°æœ€æ–°ç‰ˆæœ¬

### å»ºè®®ä¼˜åŒ– (ä¸­ä¼˜å…ˆçº§ âš ï¸)

1. âš ï¸ ä½¿ç”¨ async/await æ›¿ä»£ Promise é“¾
2. âš ï¸ æ”¹ç”¨ Composition API
3. âš ï¸ æ·»åŠ è¡¨å•æäº¤åŠ è½½çŠ¶æ€
4. âš ï¸ å®Œå–„éªŒè¯è§„åˆ™

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [uni-forms æ–‡æ¡£](https://uniapp.dcloud.net.cn/component/uniui/uni-forms.html)
- [uni-easyinput æ–‡æ¡£](https://uniapp.dcloud.net.cn/component/uniui/uni-easyinput.html)
- [è¡¨å•éªŒè¯è§„åˆ™](https://uniapp.dcloud.net.cn/component/uniui/uni-forms.html#rules)

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹ä»£ç 

```vue
<template>
  <view class="login">
    <uni-forms ref="formRef" :model="formData" :rules="rules">
      <uni-forms-item label="è´¦å·" name="username" required>
        <uni-easyinput
          type="text"
          v-model="formData.username"
          placeholder="è¯·è¾“å…¥è´¦å·"
        >
        </uni-easyinput>
      </uni-forms-item>

      <uni-forms-item label="å¯†ç " name="password" required>
        <uni-easyinput
          type="password"
          v-model="formData.password"
          placeholder="è¯·è¾“å…¥å¯†ç "
        >
        </uni-easyinput>
      </uni-forms-item>
    </uni-forms>

    <button type="default" @click="submit" :loading="loading">æäº¤è¡¨å•</button>
    <button type="default" @click="reset">é‡ç½®</button>
  </view>
</template>

<script setup>
import { ref, reactive } from "vue";

const formRef = ref();
const loading = ref(false);

const formData = reactive({
  username: null,
  password: null,
});

const rules = {
  username: {
    rules: [{ required: true, errorMessage: "è¯·è¾“å…¥è´¦å·" }],
  },
  password: {
    rules: [
      { required: true, errorMessage: "è¯·è¾“å…¥å¯†ç " },
      { minLength: 6, maxLength: 8, errorMessage: "è¯·è¾“å…¥6-8ä½çš„å¯†ç " },
    ],
  },
};

const submit = async () => {
  try {
    loading.value = true;
    const value = await formRef.value.validate();
    console.log("éªŒè¯é€šè¿‡", value);

    // TODO: æäº¤åˆ°æœåŠ¡å™¨

    uni.showToast({
      title: "æäº¤æˆåŠŸ",
      icon: "success",
    });
  } catch (err) {
    console.error("éªŒè¯å¤±è´¥", err);
  } finally {
    loading.value = false;
  }
};

const reset = () => {
  formRef.value.clearValidate();
  Object.keys(formData).forEach((key) => {
    formData[key] = null;
  });
};
</script>
```

---

**æ£€æŸ¥å®Œæˆ** âœ“
